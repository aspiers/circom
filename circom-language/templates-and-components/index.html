<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="canonical" href="http://127.0.0.1:8000/circom-language/templates-and-components/">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Templates & Components - Circom 2 Documentation</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700" />

  <link rel="stylesheet" href="../../css/theme.css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
  
  <script>
    // Current page data
    var mkdocs_page_name = "Templates & Components";
    var mkdocs_page_input_path = "circom-language/templates-and-components.md";
    var mkdocs_page_url = "/circom-language/templates-and-components/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Circom 2 Documentation</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
                <p class="caption"><span class="caption-text">Getting started</span></p>
                <ul>
                    <li class="toctree-l1"><a class="reference internal" href="../../getting-started/background/">Background on ZK</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../getting-started/installation/">Installation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../getting-started/writing-compiling-circuits/">Writing and compiling circuits</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../getting-started/computing-the-witness/">Computing the witness</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../../getting-started/proving-circuits/">Proving circuits with ZK</a>
                    </li>
                </ul>
                <p class="caption"><span class="caption-text">The circom Language</span></p>
                <ul class="current">
                    <li class="toctree-l1"><a class="reference internal" href="#">Signals</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../signals/">Signals</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../variables-and-mutability/">Variables & Mutability</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1 current"><a class="reference internal current" href="#">Templates</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="./">Templates & Components</a>
    <ul class="current">
    <li class="toctree-l3"><a class="reference internal" href="#templates">Templates</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#components">Components</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../pragma/">Pragma</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../functions/">Functions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../include/">Include</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../the-main-component/">The main Component</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Syntax</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../comment-lines/">Comment Lines</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../identifiers/">Identifiers</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../reserved-keywords/">Reserved-keywords</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../basic-operators/">Basic Operators</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../constraint-generation/">Constraint Generation</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../control-flow/">Control Flow</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../data-types/">Data Types</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="../scoping/">Scoping</a>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Code Quality</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../code-quality/code-assertion/">Code Assertion</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../code-quality/debugging-operations/">Debugging Operations</a>
                </li>
    </ul>
                    </li>
                    <li class="toctree-l1"><a class="reference internal" href="#">Circom Insight</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../circom-insight/circom-phases/">Compiler Phases</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../circom-insight/compiler-messages/">Compiler Messages</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../circom-insight/unknowns/">Unknowns</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../circom-insight/circom-library/">Circom Library</a>
                </li>
    </ul>
                    </li>
                </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Circom 2 Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>The circom Language &raquo;</li>
        
      
        
          <li>Templates &raquo;</li>
        
      
    
    <li>Templates & Components</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  
  <hr/>
</div>

          <div role="main">
            <div class="section">
              
                <h1 id="templates-components">Templates &amp; Components</h1>
<h2 id="templates">Templates</h2>
<p>The mechanism to create generic circuits in Circom is the so-called templates.</p>
<p>They are normally parametric on some values that must be instantiated when the template is used. The instantiation of a template is a new circuit object, which can be used to compose other circuits, so as part of larger circuits. Since templates define circuits by instantiation, they have their own signals (input, output, etc).</p>
<pre><code class="language-text">template tempid ( param_1, ... , param_n ) {
 signal input a;
 signal output b;

 .....

}
</code></pre>
<p>Templates cannot include local functions or template definitions.</p>
<p>Assigning a value to an input signal inside the same template where it has been defined also generates the error <em>"Exception caused by invalid assignment"</em> as can be seen in the next example.</p>
<pre><code class="language-text">pragma circom 2.0.0;

template wrong (N) {
 signal input a;
 signal output b;
 a &lt;== N;
}

component main = wrong(1);
</code></pre>
<p>The instantiation of a template is made using the keyword component and by providing the necessary parameters.</p>
<pre><code class="language-text">component c = tempid(v1,...,vn);
</code></pre>
<p>The values of the parameters should be known constants at compile time. The next code produces this compilation error message: <em>"Every component instantiation must be resolved during the constraint generation phase".</em></p>
<pre><code class="language-text">pragma circom 2.0.0;

template A(N1,N2){
   signal input in;
   signal output out; 
   out &lt;== N1 * in * N2;
}


template wrong (N) {
 signal input a;
 signal output b;
 component c = A(a,N); 
}

component main {public [a]} = wrong(1);
</code></pre>
<p>Regarding the signals defined in the template that will be part of the component, the following compiler messages will be generated if we use the option <code>--inspect</code> to compile the code:</p>
<ul>
<li>If a signal is not used in any constraint, a warning message will be generated. Moreover, if it is an input signal x then the compiler would suggest adding a constraint of the form x * 0 === 0;</li>
</ul>
<pre><code class="language-text">pragma circom 2.0.0;

template A(N){
   signal input in;
   signal intermediate;
   signal output out;
   intermediate &lt;== 1;
   out &lt;== intermediate;
}

component main {public [in]} = A(1);
</code></pre>
<p>During the compilation of this code, we obtain the next warning message: <em>"In template "A(1)".             Unconstrained signal. "in" = Maybe use: in*0 === 0"</em></p>
<ul>
<li>If an intermediary signal is used only in one constraint, a hint message will be generated.</li>
</ul>
<pre><code class="language-text">pragma circom 2.0.0;

template A(N){
   signal input in;
   signal inter;
   inter &lt;== 1;
   signal output out;
   out &lt;== in;
}
component main {public [in]} = A(1);
</code></pre>
<p>During the compilation of this code, we obtain the next warning message: "_In template "A(1)". One constraint intermediate: "inter" = Maybe use: inter*0 === 0".</p>
<ul>
<li>If there is no output signal a warning message will be generated. </li>
</ul>
<pre><code class="language-text">pragma circom 2.0.0;

template A(N){
   signal input in;
}
component main {public [in]} = A(1);
</code></pre>
<p>During the compilation of this code, we obtain the next warning message: <em>"There is no output signal."</em>.</p>
<h2 id="components">Components</h2>
<p>A component defines an arithmetic circuit and, as such, it receives N input signals and produces M output signals and K intermediate signals. Additionally, it can produce a set of constraints.</p>
<p>In order to access the input or output signals of a component, we will use <strong>dot notation</strong>. No other signals are visible outside the component.</p>
<pre><code class="language-text">c.a &lt;== y*z-1;
var x;
x = c.b;
</code></pre>
<p>The <strong>component instantiation</strong> will not be triggered until all its input signals are assigned to concrete values. Therefore the instantiation might be delayed and hence the component creation instruction does not imply the execution of the component object, but the creation of the instantiation process that will be completed when all the inputs are set. The output signals of a component can only be used when all inputs are set, otherwise a compiler error is generated. For instance, the following piece of code would result in an error:</p>
<pre><code class="language-text">pragma circom 2.0.0;

template Internal() {
   signal input in[2];
   signal output out;
   out &lt;== in[0]*in[1];
}

template Main() {
   signal input in[2];
   signal output out;
   component c = Internal ();
   c.in[0] &lt;== in[0];
   c.out ==&gt; out;  // c.in[1] is not assigned yet
   c.in[1] &lt;== in[1];  // this line should be placed before calling c.out
}

component main = Main();
</code></pre>
<p><strong>Components are immutable</strong> (like signals). A component can be declared first and initialized in a second step. If there are several initialization instructions (in different execution paths) they all need to be instantiations of the same template (maybe with different values for the parameters).</p>
<pre><code class="language-text">template A(N){
   signal input in;
   signal output out;
   out &lt;== in;
}

template C(N){
   signal output out;
   out &lt;== N;
}
template B(N){
  signal output out;
  component a;
  if(N &gt; 0){
     a = A(N);
  }
  else{
     a = A(0);
  }
}

component main = B(1);
</code></pre>
<p>If the instruction <code>a = A(0);</code>is replaced with <code>a = C(0)</code>, the compilation fails and the next error message is shown: <em>"Assignee and assigned types do not match"</em>.</p>
<p>We can define <strong>arrays of components</strong> following the same restrictions on the size given before. Moreover, initialization in the definition of arrays of components is not allowed, and instantiation can only be made component by component, accessing the positions of the array. All components in the array have to be instances of the same template as it can be seen in the next example.</p>
<pre><code class="language-text">template MultiAND(n) {
    signal input in[n];
    signal output out;
    component and;
    component ands[2];
    var i;
    if (n==1) {
        out &lt;== in[0];
    } else if (n==2) {
          and = AND();
        and.a &lt;== in[0];
        and.b &lt;== in[1];
        out &lt;== and.out;
    } else {
        and = AND();
    var n1 = n\2;
        var n2 = n-n\2;
        ands[0] = MultiAND(n1);
        ands[1] = MultiAND(n2);
        for (i=0; i&lt;n1; i++) ands[0].in[i] &lt;== in[i];
        for (i=0; i&lt;n2; i++) ands[1].in[i] &lt;== in[n1+i];
        and.a &lt;== ands[0].out;
        and.b &lt;== ands[1].out;
        out &lt;== and.out;
    }
}
</code></pre>
<p>When components are independent (the inputs do not depend on each othersâ€™ outputs), the computation of these parts can be done in parallel using the tag <code>parallel</code>, like shown in the next line.</p>
<pre><code class="language-text">template parallel NameTemplate(...){...}
</code></pre>
<p>If this tag is used, the resulting C++ file will contain the parallelized code to compute the witness. Parallelization becomes particularly relevant when dealing with large circuits.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pragma/" class="btn btn-neutral float-right" title="Pragma">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../variables-and-mutability/" class="btn btn-neutral" title="Variables & Mutability"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../variables-and-mutability/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../pragma/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
